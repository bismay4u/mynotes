<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notes</title>

    <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="manifest" href="favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="search-box">
            <div class="mb-3">
                <input type="text" class="form-control" id="searchInput" placeholder="Search notes...">
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm flex-fill" id="showAllBtn">
                    <i class="fas fa-list me-1"></i> All Notes
                </button>
                <button class="btn btn-outline-secondary btn-sm" id="clearFiltersBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <div class="px-3 pb-3">
            <h6 class="text-muted mb-3"># Tags</h6>
            <div id="tagsList">
                <!-- Tags will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-notes">
            <!-- Quick Add Form -->
            <div class="quick-add-form">
                <h5 class="mb-3">
                    <i class="fas fa-sticky-note text-primary me-2"></i>

                    <i id='openSidePanel' class="fas fa-sliders text-primary me-2 float-end"></i>

                    Add New Note
                </h5>
                <form id="quickAddForm">
                    <div class="mb-3">
                        <textarea 
                            class="form-control quick-add-textarea" 
                            id="noteContent" 
                            rows="3" 
                            placeholder="Write your note here... Use #hashtags to organize your thoughts!"
                            required
                        ></textarea>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="fas fa-hashtag me-1"></i>
                            Hashtags will be automatically extracted and stored as tags
                        </small>
                        <button type="submit" class="btn btn-primary btn-add">
                            <i class="fas fa-save me-2"></i>Save Note
                        </button>
                    </div>
                </form>
            </div>

            <!-- Notes List -->
            <div id="notesContainer">
                <!-- Notes will be loaded here -->
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="text-center py-5" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Loading notes...</p>
            </div>
        </div> 

        <!-- Resizer -->
        <!-- <div class="resizer" id="resizer"></div> -->

        <div id='content-tabbed' class="content-tabbed d-none">
            <!-- Tab Header -->
            <div class="tab-header">
                <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="chat-tab" data-bs-toggle="tab" data-bs-target="#chat-pane" type="button" role="tab">
                            <i class="fas fa-comments me-2"></i>Chat
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="editor-tab" data-bs-toggle="tab" data-bs-target="#editor-pane" type="button" role="tab">
                            <i class="fas fa-edit me-2"></i>Note Editor
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabContent">
                <!-- Chat Interface -->
                <div class="tab-pane fade show active" id="chat-pane" role="tabpanel">
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="text-center text-muted py-4">
                                <i class="fas fa-comments fa-3x mb-3" style="opacity: 0.3;"></i>
                                <h5>Chat Interface</h5>
                                <p>Start a conversation here...</p>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <div class="input-group">
                                <textarea class="form-control chat-input" id="chatInput" placeholder="Type your message..." rows="1"></textarea>
                                <button class="btn btn-primary" type="button" id="sendChatBtn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Note Editor -->
                <div class="tab-pane fade" id="editor-pane" role="tabpanel">
                    <div class="editor-container">
                        <div class="editor-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-edit text-primary me-2"></i>
                                    <span id="editorTitle">Note Editor</span>
                                </h5>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" id="newNoteBtn">
                                        <i class="fas fa-plus me-1"></i>New
                                    </button>
                                    <button class="btn btn-outline-primary" id="saveNoteBtn" disabled>
                                        <i class="fas fa-save me-1"></i>Save
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="editor-content">
                            <textarea class="editor-textarea" id="editorTextarea" placeholder="Start writing your note here... Use #hashtags to organize your thoughts!"></textarea>
                            <div class="editor-actions">
                                <div class="editor-info">
                                    <span id="wordCount">0 words</span> â€¢ 
                                    <span id="charCount">0 characters</span>
                                </div>
                                <div>
                                    <button class="btn btn-outline-danger btn-sm" id="clearEditorBtn">
                                        <i class="fas fa-trash me-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>   
    </div>
    
    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Note</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editNoteId">
                        <div class="mb-3">
                            <textarea class="form-control" id="editNoteContent" rows="6" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Note</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editNoteId">
                        <div class="mb-3">
                            <label for="editNoteContent" class="form-label">Content</label>
                            <textarea class="form-control" id="editNoteContent" rows="6" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/notes';

        class NotesApp {
            constructor() {
                this.notes = [];
                this.tags = [];
                this.currentFilter = null;
                this.currentSearch = '';
                this.author = '';
                this.currentEditingNote = null;
                this.editModal = new bootstrap.Modal(document.getElementById('editModal'));
                this.tagColors = [
                        "#5737D7", "#D63F9A", "#F95959", "#5E7DFA", "#27CA69",
                        "#43B79F", "#A100C9", "#BE02BE", "#C1AA4B", "#5ED276",
                        "#3DA5BF", "#2BFCFC", "#37C015", "#92EF07", "#0808F6",
                        "#1FDD91", "#B75E47", "#5E1DBF", "#EF0C67", "#9EFB61",
                        "#E6E60D", "#206FE6", "#9C0EFB", "#B44C06", "#C6F609",
                        "#5CDA5C", "#B47A24", "#4794C7", "#E24766", "#E318BA"
                    ];
                
                this.showLoading(true);
                
                if(localStorage.getItem("AUTHOR")==null) {
                    var ans = prompt("What is your AUTHOR Name (no space allowed)")
                    localStorage.setItem("AUTHOR", this.sanitizeString(ans));
                }
                this.author = localStorage.getItem("AUTHOR");
                if(this.author==null) this.author = "guest";

                this.initializeEventListeners();
                this.initializeEditor();
                this.loadData();
            }
            
            initializeEventListeners() {
                // Quick add form
                document.getElementById('quickAddForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addNote();
                });

                document.getElementById('openSidePanel').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.toggleRightPane();
                });
                
                
                // Search
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.currentSearch = e.target.value;
                    this.filterAndDisplayNotes();
                });
                
                // Show all notes
                document.getElementById('showAllBtn').addEventListener('click', () => {
                    this.clearFilters();
                });
                
                // Clear filters
                document.getElementById('clearFiltersBtn').addEventListener('click', () => {
                    this.clearFilters();
                });
                
                // Edit form save
                document.getElementById('saveEditBtn').addEventListener('click', () => {
                    this.saveEdit();
                });

                // Chat functionality
                document.getElementById('sendChatBtn').addEventListener('click', () => {
                    this.sendChatMessage();
                });

                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendChatMessage();
                    }
                });
            }

            initializeEditor() {
                const editorTextarea = document.getElementById('editorTextarea');
                const saveBtn = document.getElementById('saveNoteBtn');
                const newBtn = document.getElementById('newNoteBtn');
                const clearBtn = document.getElementById('clearEditorBtn');

                // Auto-resize textarea and update counters
                editorTextarea.addEventListener('input', () => {
                    this.updateWordCount();
                    this.updateSaveButton();
                });

                // Save note
                saveBtn.addEventListener('click', () => {
                    this.saveFromEditor();
                });

                // New note
                newBtn.addEventListener('click', () => {
                    this.newNoteInEditor();
                });

                // Clear editor
                clearBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to clear the editor?')) {
                        this.clearEditor();
                    }
                });

                // Auto-save on Ctrl+S
                editorTextarea.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        this.saveFromEditor();
                    }
                });
            }
            
            async loadData() {
                await Promise.all([this.loadNotes(), this.loadTags()]);
                this.filterAndDisplayNotes();
            }
            
            async loadNotes() {
                try {
                    const response = await fetch(API_BASE+'/api/notes', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ author: this.author })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    this.notes = await response.json();
                } catch (error) {
                    console.error('Error loading notes:', error);
                    this.showError('Failed to load notes');
                    this.notes = [];
                }
            }
            
            async loadTags() {
                try {
                    const response = await fetch(API_BASE+'/api/tags', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ author: this.author })
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    this.tags = await response.json();
                    this.displayTags();
                } catch (error) {
                    console.error('Error loading tags:', error);
                    this.tags = [];
                    this.displayTags();
                }
            }
            
            getTagColor(tagName) {
                const tagUnit = this.tags.filter(a=>a.name==tagName);

                if(tagUnit.length>0) return tagUnit[0]['color'];
                else {
                    const hash = this.hashCode(tagName);
                    return this.tagColors[Math.abs(hash) % this.tagColors.length];
                }
            }
            
            hashCode(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash;
            }
            
            displayTags() {
                const tagsList = document.getElementById('tagsList');
                
                if (this.tags.length === 0) {
                    tagsList.innerHTML = '<p class="text-muted small">No tags yet</p>';
                    return;
                }
                
                tagsList.innerHTML = this.tags.map(tag => `
                    <a href="#" class="sidebar-tag ${this.currentFilter === tag.name ? 'active' : ''}" 
                       data-tag="${tag.name}">
                        <span>
                            <span class="tag-badge" style="background-color: ${tag.color}">#</span>
                            ${tag.name}
                        </span>
                        <span class="tag-count">${tag.note_count}</span>
                    </a>
                `).join('');
                
                // Add click listeners to tags
                tagsList.querySelectorAll('.sidebar-tag').forEach(tagEl => {
                    tagEl.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tagName = e.currentTarget.dataset.tag;
                        this.filterByTag(tagName);
                    });
                });
            }
            
            filterByTag(tagName) {
                this.currentFilter = tagName;
                this.filterAndDisplayNotes();
                this.displayTags(); // Update active state
            }
            
            clearFilters() {
                this.currentFilter = null;
                this.currentSearch = '';
                document.getElementById('searchInput').value = '';
                this.filterAndDisplayNotes();
                this.displayTags(); // Update active state
            }
            
            filterAndDisplayNotes() {
                this.showLoading(true);
                let filteredNotes = [...this.notes];
                
                // Apply tag filter
                if (this.currentFilter) {
                    filteredNotes = filteredNotes.filter(note => 
                        note.tags && note.tags.includes(this.currentFilter)
                    );
                }
                
                // Apply search filter
                if (this.currentSearch) {
                    const searchLower = this.currentSearch.toLowerCase();
                    filteredNotes = filteredNotes.filter(note =>
                        note.title.toLowerCase().includes(searchLower) ||
                        note.content.toLowerCase().includes(searchLower)
                    );
                }
                
                // Sort by creation date (newest first)
                filteredNotes.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                
                this.displayNotes(filteredNotes);
            }
            
            displayNotes(notes) {
                this.showLoading(false);
                const container = document.getElementById('notesContainer');
                
                if (notes.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-sticky-note"></i>
                            <h5>No notes found</h5>
                            <p>${this.currentFilter || this.currentSearch ? 'Try adjusting your filters' : 'Start by adding your first note above'}</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = notes.map(note => `
                    <div class="note-card" data-note-id="${note.id}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="note-title">${this.escapeHtml(note.title)}</div>
                                <pre class="note-content">${this.formatContent(note.content)}</pre>
                                <div class="mb-2">
                                    ${note.tags ? note.tags.map(tag => {
                                        const color = this.getTagColor(tag);
                                        return `<span class="tag-badge" style="background-color: ${color}" data-tag="${tag}">#${tag}</span>`;
                                    }).join('') : ''}
                                </div>
                                <div class="note-meta">
                                    <span>${this.formatDate(note.created_at)}</span>
                                </div>
                            </div>
                            <div class="note-actions ms-3">
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="app.showFullNote(this, ${note.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="app.editNote(${note.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="app.deleteNote(${note.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Add click listeners to tag badges in notes
                container.querySelectorAll('.tag-badge').forEach(badge => {
                    badge.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const tag = e.target.dataset.tag;
                        this.filterByTag(tag);
                    });
                });
            }
            
            formatContent(content) {
                // Highlight hashtags in content
                return this.escapeHtml(content).replace(/#(\w+)/g, '<span class="text-primary fw-bold">#$1</span>');
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays < 7) return `${diffDays}d ago`;
                
                return date.toLocaleDateString();
            }

            sanitizeString(input) {
                // Replace all non-alphanumeric characters with _
                let result = input.replace(/[^a-zA-Z0-9]/g, '_');
                
                // Replace multiple consecutive underscores with a single underscore
                result = result.replace(/_+/g, '_');
                
                // (Optional) Trim leading and trailing underscores
                result = result.replace(/^_+|_+$/g, '');

                return result;
            }
            
            updateWordCount() {
                const text = document.getElementById('editorTextarea').value;
                const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                const chars = text.length;

                document.getElementById('wordCount').textContent = `${words} words`;
                document.getElementById('charCount').textContent = `${chars} characters`;
            }

            extractHashtags(content) {
                const hashtags = content.match(/#(\w+)/g);
                return hashtags ? hashtags.map(tag => tag.substring(1).toLowerCase()) : [];
            }
            
            generateTitle(content) {
                // Extract first line or first sentence as title
                const firstLine = content.split('\n')[0].trim();
                const title = firstLine.length > 50 ? firstLine.substring(0, 50) + '...' : firstLine;
                return title || 'Untitled Note';
            }

            updateSaveButton() {
                const hasContent = document.getElementById('editorTextarea').value.trim().length > 0;
                document.getElementById('saveNoteBtn').disabled = !hasContent;
            }

            newNoteInEditor() {
                this.currentEditingNote = null;
                document.getElementById('editorTextarea').value = '';
                document.getElementById('editorTitle').textContent = 'New Note';
                this.updateWordCount();
                this.updateSaveButton();
            }

            clearEditor() {
                this.newNoteInEditor();
            }

            async saveFromEditor() {
                const content = document.getElementById('editorTextarea').value.trim();
                if (!content) return;

                try {
                    if (this.currentEditingNote) {
                        const id = this.currentEditingNote.id;

                        const response = await fetch(API_BASE+`/api/notes/${id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content, author: this.author })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        await this.loadData();
                        this.showSuccess('Note updated successfully!');
                    } else {
                        const response = await fetch(API_BASE+'/api/notes/create', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content, author: this.author })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        document.getElementById('editorTextarea').value = '';
                        await this.loadData();
                        this.showSuccess('Note added successfully!');
                    }
                } catch (error) {
                    console.error('Error saving note:', error);
                    this.showError('Failed to save note. Please try again.');
                }
            }
            
            async addNote() {
                const content = document.getElementById('noteContent').value.trim();
                if (!content) return;
                
                try {
                    const response = await fetch(API_BASE+'/api/notes/create', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content, author: this.author })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    document.getElementById('noteContent').value = '';
                    await this.loadData();
                    this.showSuccess('Note added successfully!');
                } catch (error) {
                    console.error('Error adding note:', error);
                    this.showError('Failed to add note');
                }
            }
            
            showFullNote(btn) {
                let parent = btn.closest('.note-card');

                parent.classList.toggle("show_more");
            }

            editNote(id) {
                const note = this.notes.find(n => n.id === id);
                if (!note) return;
                
                // document.getElementById('editNoteId').value = id;
                // document.getElementById('editNoteContent').value = note.content;
                // this.editModal.show();

                this.currentEditingNote = note;
                document.getElementById('editorTextarea').value = note.content;
                document.getElementById('editorTitle').textContent = `Editing Note #${note.id}`;
                this.updateWordCount();
                this.updateSaveButton();
                
                // Switch to editor tab
                const editorTab = document.getElementById('editor-tab');
                editorTab.click();

                if(document.getElementById("content-tabbed").classList.contains("d-none")) {
                    document.getElementById("content-tabbed").classList.toggle("d-none");
                }
            }
            
            async saveEdit() {
                const id = parseInt(document.getElementById('editNoteId').value);
                const content = document.getElementById('editNoteContent').value.trim();
                
                if (!content) return;
                
                try {
                    const response = await fetch(API_BASE+`/api/notes/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content, author: this.author })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    this.editModal.hide();
                    await this.loadData();
                    this.showSuccess('Note updated successfully!');
                } catch (error) {
                    console.error('Error updating note:', error);
                    this.showError('Failed to update note');
                }
            }
            
            async deleteNote(id) {
                if (!confirm('Are you sure you want to delete this note?')) return;
                
                try {
                    const response = await fetch(API_BASE+`/api/notes/${id}`, {
                        method: 'DELETE',
                        body: JSON.stringify({ author: this.author })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    await this.loadData();
                    this.showSuccess('Note deleted successfully!');
                } catch (error) {
                    console.error('Error deleting note:', error);
                    this.showError('Failed to delete note');
                }
            }

            sendChatMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                if (!message) return;

                this.addChatMessage(message, 'user');
                input.value = '';

                // Simulate bot response
                setTimeout(() => {
                    const responses = [
                        "I'm a demo chat interface. In a real implementation, I would be connected to an AI service.",
                        "That's interesting! Tell me more about your notes.",
                        "I can help you organize your thoughts and notes.",
                        "Would you like me to help you create a new note?",
                        "I notice you have some interesting tags in your notes!"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    this.addChatMessage(randomResponse, 'bot');
                }, 1000);
            }

            addChatMessage(message, sender) {
                const messagesContainer = document.getElementById('chatMessages');
                const messageEl = document.createElement('div');
                messageEl.className = `chat-message ${sender}`;
                messageEl.textContent = message;

                // Remove placeholder if it exists
                const placeholder = messagesContainer.querySelector('.text-center.text-muted');
                if (placeholder) {
                    placeholder.remove();
                }

                messagesContainer.appendChild(messageEl);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            showLoading(show) {
                document.getElementById('loadingState').style.display = show ? 'block' : 'none';
                document.getElementById('notesContainer').style.display = show ? 'none' : 'block';
            }
            
            showSuccess(message) {
                this.showAlert(message, 'success');
            }
            
            showError(message) {
                this.showAlert(message, 'danger');
            }
            
            showAlert(message, type) {
                // Remove existing alerts
                const existingAlerts = document.querySelectorAll('.alert');
                existingAlerts.forEach(alert => alert.remove());
                
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                document.body.appendChild(alertDiv);
                
                // Show alert with animation
                setTimeout(() => alertDiv.classList.add('show'), 100);
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.classList.remove('show');
                        setTimeout(() => alertDiv.remove(), 300);
                    }
                }, 5000);
            }

            toggleRightPane() {
                document.getElementById("content-tabbed").classList.toggle("d-none");
            }
        }
        
        // Initialize the app when DOM is loaded
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new NotesApp();
        });
    </script>
</body>
</html>